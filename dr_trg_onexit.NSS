////////////////////////////////////////////////////////////////////////////////
//
//  System Name : ACR Configuration File
//     Filename : acf_trg_onenter.nss
//    $Revision:: 236        $ current version of the file
//        $Date:: 2007-01-21#$ date the file was created or modified
//       Author : Cipher
//
//    Var Prefix:
//  Dependencies:
//
//  Description
//  This script calls the ACR's OnEnter code for triggers, and any
//  custom code a server may need. It is not updated in ACR updates.
//
//  Revision History
//  2007/01/20  Cipher  Inception
//  October 2008, Wynna
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes ////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
#include "acr_trigger_i"
#include "acr_quest_i"



////////////////////////////////////////////////////////////////////////////////
// Constants ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Structures //////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Global Variables ////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Prototypes /////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Definitions ////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

void main()
{
    ACR_TriggerOnExit();

    // Custom code goes here.
	

//5b Settlestone Dungeon of the Ruins. 

if(GetTag(OBJECT_SELF) == "dr_directional")
	{SetLocalInt(GetExitingObject(), "Directional", 0);
	}
	
 if(FindSubString(GetTag(OBJECT_SELF), "dr_rowboat") != -1)
	{object oMasterWP = GetLocalObject(OBJECT_SELF, "oMasterWP");
	 if(oMasterWP == OBJECT_INVALID)
	 	{oMasterWP = GetWaypointByTag("dr_lockdoor_up_WP");
		SetLocalObject(OBJECT_SELF, "oMasterWP", oMasterWP);
		}
	  object oMyBoat = GetLocalObject(OBJECT_SELF, "oMyBoat");
	  if(oMyBoat == OBJECT_INVALID)
	 	{oMyBoat = GetObjectByTag(GetTag(OBJECT_SELF) + "_boat");
		SetLocalObject(OBJECT_SELF, "oMyBoat", oMyBoat);
		}
	  object oMyLaunch = GetLocalObject(OBJECT_SELF, "oMyLaunch");
	  if(oMyLaunch == OBJECT_INVALID)
	 	{oMyLaunch = GetObjectByTag(GetTag(OBJECT_SELF) + "_go");
		SetLocalObject(OBJECT_SELF, "oMyLaunch", oMyLaunch);
		}
	  int nCount = GetLocalInt(oMyBoat, "nCount");
	  object oBoater = GetExitingObject();
	  if(oMyBoat != OBJECT_INVALID) 
	  	{SetLocalInt(oMyBoat, "nCount", nCount - 1);
		 SetLocalInt(oBoater, GetTag(OBJECT_SELF), 0);
		 SendMessageToPC(oBoater, "You disembark.");
		 }		 
	 }


}