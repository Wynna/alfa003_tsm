////////////////////////////////////////////////////////////////////////////////
//
//  System Name : ACR Configuration File
//     Filename : acf_trg_onexit.nss
//    $Revision:: 236        $ current version of the file
//        $Date:: 2007-01-21#$ date the file was created or modified
//       Author : Cipher
//
//    Var Prefix:
//  Dependencies:
//
//  Description
//  This script calls the ACR's OnExit code for triggers, and any
//  custom code a server may need. It is not updated in ACR updates.
//
//  Revision History
//  2007/01/20  Cipher  Inception
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes ////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
#include "acr_trigger_i"

////////////////////////////////////////////////////////////////////////////////
// Constants ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Structures //////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Global Variables ////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Prototypes /////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Definitions ////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

void main()
{
    ACR_TriggerOnExit();

   // Silvy Quest 3 to turn sewer entrance placeable unuseable on departure	 	 
 if(GetTag(OBJECT_SELF) == "silvy_quest3_sewer") 
 	{object oSewer = GetLocalObject(OBJECT_SELF, "Sewer");
	 if(oSewer == OBJECT_INVALID)
	 	{oSewer = GetObjectByTag("03_plc_sewer_quest3");
		}
	 SetUseableFlag(oSewer, FALSE);
		
	}
 // Destroying invisible listener that controls Sylune's portal
 
 if((GetTag(OBJECT_SELF) == "sm_sylune_listener") && (GetIsPC(GetExitingObject())))
 	{string sArea = "_palace";
	  if(GetTag(GetArea(OBJECT_SELF)) == "6d_int_silvy_catacombs_1")
				{sArea = "_catacombs";
				}
	 object oMyHeadstone = GetLocalObject(OBJECT_SELF, "oMyHeadstone");
	  if(oMyHeadstone == OBJECT_INVALID)
			 	{oMyHeadstone = GetObjectByTag(GetTag(OBJECT_SELF) + sArea);
				 SetLocalObject(OBJECT_SELF, "oMyHeadstone", oMyHeadstone);
				 }
		  
	  object oMyListener = GetLocalObject(OBJECT_SELF, "oMyListener");
	  DelayCommand(60.0, DestroyObject(oMyListener));
	  SetLocalObject(OBJECT_SELF, "oMyListener", OBJECT_INVALID);
 	  SetLocalObject(oMyHeadstone, "oMyListener", OBJECT_INVALID);
	}	
 
  
 
	

}