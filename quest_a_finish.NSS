////////////////////////////////////////////////////////////////////////////////
//
//  System Name : ALFA Quest System
//     Filename : acr_quest_reward
//    $Revision:: 428        $ current version of the file
//        $Date:: 2010-08-14#$ date the file was created or modified
//       Author : Cipher
//
//  Description
//  This script finalizes quests by awarding gold and removing quest items.
//	This should be used in the Actions Taken branch of a conversation.
//
//  Revision History
//  2007/09/20  Cipher   Inception
//  2010/08/15  AcadiusLost - interim patch for item quest fixes
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes ////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////
#include "acr_quest_i"

////////////////////////////////////////////////////////////////////////////////
// Constants ///////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Structures //////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Global Variables ////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Prototypes /////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Function Definitions ////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////

void main(string sQuest, int nGold, int bPartyWide=FALSE, int bXP=FALSE)
{
	object oPC = GetPCSpeaker();
	object oItem = GetLocalObject(oPC, sQuest);
	int nXPaward = 0;
	// reward the player
	GiveGoldToCreature(oPC, nGold);

	// if bXP, award the quest XP defined in the module journal.
	if (bXP) { nXPaward = GetJournalQuestExperience(sQuest); }
	
	// update the quest to its final (completed) state
	ACR_AddPersistentJournalQuestEntry(sQuest, ACR_RetrieveQuestState(sQuest, oPC) + 1, oPC, bPartyWide, FALSE, FALSE, nXPaward);
	
	// if a quest item exits, take care of it:
	if (GetIsObjectValid(oItem)) {
		// clear the quest variable from the item, so it doesn't re-decrement
		DeleteLocalString(oItem, sQuest);
		// remove the quest item
		DestroyObject(oItem);
	}
}